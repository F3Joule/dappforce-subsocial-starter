http:
  services:
    ws-service:
      loadbalancer:
        healthcheck:
          path: /health
          port: 9933
          interval: "5s"
          timeout: "2s"
        passHostHeader: false
        servers:
          - url: "http://localhost:9944"

    rpc-service:
      loadbalancer:
        healthcheck:
          path: /health
          interval: "5s"
          timeout: "2s"
        passHostHeader: false
        servers:
          - url: "http://localhost:9933"

  routers:
    ws-router:
      rule: "Host(`localhost`) && Path(`/`)"
      service: ws-service
      middlewares:
        - ws-secure
      tls:
        certResolver: "le"

    rpc-router:
      rule: "Host(`localhost`) && Path(`/http`)"
      service: rpc-service
      middlewares:
        - rpc-secure
      tls:
        certResolver: "le"

  middlewares:
    rpc-secure:
      chain:
        middlewares:
          - allowed-origins-secure
          - access-control-rpc

    ws-secure:
      chain:
        middlewares:
          - allowed-origins-secure
          - access-control-ws

    allowed-origins-secure:
      headers:
        accessControlMaxAge: 100
        addVaryHeader: true
        frameDeny: true
        contentTypeNosniff: true
        accessControlAllowOriginList:
          - https://app.subsocial.network
          - https://sub.id
          - https://polkaverse.com
          - https://polkadot.js.org

    access-control-ws:
      headers:
        accessControlAllowMethods: [ GET ]
        accessControlAllowHeaders:
          - Connection
          - Upgrade
          - Sec-WebSocket-Key
          - Sec-WebSocket-Version

    access-control-rpc:
      headers:
        accessControlAllowMethods: [ OPTIONS, POST ]
        accessControlAllowHeaders:
          - Content-Type
